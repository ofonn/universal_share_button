<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Universal Share (Navigator + Escape)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .platform-button {
        transition: all 0.15s ease-in-out;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -2px rgba(0, 0, 0, 0.1);
      }
      .platform-button:hover {
        transform: translateY(-2px);
      }
      .platform-button:active {
        transform: translateY(0);
      }
      pre {
        white-space: pre-wrap;
      }
      .note {
        font-size: 0.9rem;
        color: #6b7280;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-100 p-4 flex items-center justify-center">
    <div class="w-full max-w-lg bg-white p-6 md:p-8 rounded-xl shadow-2xl">
      <h1 class="text-3xl font-extrabold text-gray-800 mb-2">
        Universal Share (Navigator + Escape)
      </h1>
      <p class="note mb-4">
        Click an app below. If you're inside the Telegram Mini App this will
        open your external browser and then immediately trigger the native share
        sheet (navigator.share). We focus only on the native-share path on the
        external page.
      </p>

      <div id="message-box" class="hidden"></div>

      <div class="space-y-4">
        <button
          onclick="onChoose('telegram')"
          class="platform-button w-full bg-[#229ED9] text-white p-4 rounded-lg font-bold"
        >
          Share â†’ Telegram (open external)
        </button>
        <button
          onclick="onChoose('whatsapp')"
          class="platform-button w-full bg-[#25D366] text-white p-4 rounded-lg font-bold"
        >
          Share â†’ WhatsApp (open external)
        </button>
        <button
          onclick="onChoose('discord')"
          class="platform-button w-full bg-[#5865F2] text-white p-4 rounded-lg font-bold"
        >
          Share â†’ Discord (open external)
        </button>
        <button
          onclick="onChoose('signal')"
          class="platform-button w-full bg-[#3A76F0] text-white p-4 rounded-lg font-bold"
        >
          Share â†’ Signal (open external)
        </button>
      </div>

      <div class="mt-6 pt-4 border-t">
        <h3 class="text-lg font-bold text-gray-700 mb-2">Content to Share:</h3>
        <pre
          class="bg-gray-50 p-3 rounded-lg text-sm text-gray-800 overflow-x-auto"
          id="share-content-preview"
        ></pre>
      </div>
    </div>

    <script>
          // Content to share
          const SHARE_TEXT = `SECRET SLUT ðŸ¤«ðŸ”ž ðŸ”—
      tegram.me/o3hatzB969EyZDg8
      https://tegram.me/XDOUBLEBANG
      xtelegram.me/RATPIMAX
      JOIN Check it Out6`;
          const SHARE_URL = 'https://tegram.me/XDOUBLEBANG';
          const CONTENT = SHARE_TEXT + "

      " + SHARE_URL;

          document.getElementById('share-content-preview').textContent = CONTENT;

          // Detect Telegram WebApp (Mini App)
          function inTelegramWebApp() {
            return !!(window.Telegram && window.Telegram.WebApp);
          }

          // Show temporary message
          function showMessage(msg, cls = 'bg-gray-500') {
            const box = document.getElementById('message-box');
            box.innerHTML = msg;
            box.className = `p-3 mb-4 rounded-lg text-sm font-semibold text-white ${cls}`;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 3000);
          }

          // Called when user picks a platform in the mini app
          function onChoose(platform) {
            // If navigator.share is available here (not in mini app) use it directly
            if (navigator.share && !inTelegramWebApp()) {
              navigator.share({ title: 'Share', text: CONTENT, url: SHARE_URL }).catch(err => {
                console.error('share failed', err);
                showMessage('Share failed', 'bg-red-500');
              });
              return;
            }

            // Build escape URL which includes the chosen platform and content
            const encoded = encodeURIComponent(CONTENT);
            const escapeUrl = `${location.origin}${location.pathname}?platform=${encodeURIComponent(platform)}&content=${encoded}`;

            if (inTelegramWebApp()) {
              try {
                // open externally (in-app browser) - Telegram should open this outside the mini app
                Telegram.WebApp.openLink(escapeUrl, { try_instant_view: false });
              } catch (e) {
                // fallback to window.open
                window.open(escapeUrl, '_blank');
              }
              return;
            }

            // If not in Telegram WebApp and navigator.share not available, show message
            showMessage('Native share not supported in this environment', 'bg-red-500');
          }

          // When landing on the page (possibly after escaping), auto-run navigator.share
          async function autoRunFromParams() {
            const params = new URLSearchParams(location.search);
            const platform = params.get('platform');
            const encodedContent = params.get('content');
            if (!platform) return; // nothing to auto-run

            const text = encodedContent ? decodeURIComponent(encodedContent) : CONTENT;

            // Try navigator.share immediately on this external page
            if (navigator.share) {
              try {
                await navigator.share({ title: 'Share', text, url: SHARE_URL });
                // success - we don't need to do anything else
                return;
              } catch (err) {
                console.warn('navigator.share failed on redirect page', err);
                // if it fails fall back to a web link for the platform (so user can continue)
              }
            }

            // Fallback: open web share URL for the chosen platform
            switch (platform) {
              case 'telegram':
                window.open(`https://t.me/share/url?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent(text)}`, '_blank');
                break;
              case 'whatsapp':
                window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`, '_blank');
                break;
              case 'signal':
                window.open(`https://signal.me/share/text?text=${encodeURIComponent(text)}`, '_blank');
                break;
              case 'discord':
                // Discord has no deep text scheme; open Discord web and the user can paste
                window.open('https://discord.com/app', '_blank');
                break;
              default:
                showMessage('No fallback available', 'bg-red-500');
            }
          }

          // On load: run auto-run and also show debug if Telegram WebApp present
          window.addEventListener('DOMContentLoaded', () => {
            if (inTelegramWebApp()) console.log('Running inside Telegram WebApp (mini app)');
            autoRunFromParams();
          });
    </script>
  </body>
</html>
