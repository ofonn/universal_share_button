<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Universal Share (Navigator + Escape) â€” Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .platform-button {
        transition: all 0.15s ease-in-out;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -2px rgba(0, 0, 0, 0.1);
      }
      .platform-button:hover {
        transform: translateY(-2px);
      }
      .platform-button:active {
        transform: translateY(0);
      }
      pre {
        white-space: pre-wrap;
      }
      .note {
        font-size: 0.9rem;
        color: #6b7280;
      }
      .log {
        font-family: monospace;
        font-size: 12px;
        color: #111;
        background: #f3f4f6;
        padding: 8px;
        border-radius: 6px;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-100 p-4 flex items-center justify-center">
    <div class="w-full max-w-lg bg-white p-6 md:p-8 rounded-xl shadow-2xl">
      <h1 class="text-2xl font-extrabold text-gray-800 mb-2">
        Universal Share (Navigator + Escape) â€” Fixed
      </h1>
      <p class="note mb-4">
        Click any button. This will always open the external page (same page
        with query params). The external page will immediately attempt
        <code>navigator.share()</code> on load and will do nothing else if it
        fails.
      </p>

      <div class="space-y-3 mb-4">
        <button
          onclick="onChoose('telegram')"
          class="platform-button w-full bg-[#229ED9] text-white p-3 rounded-lg font-bold"
        >
          Share â†’ Telegram (open external)
        </button>
        <button
          onclick="onChoose('whatsapp')"
          class="platform-button w-full bg-[#25D366] text-white p-3 rounded-lg font-bold"
        >
          Share â†’ WhatsApp (open external)
        </button>
        <button
          onclick="onChoose('discord')"
          class="platform-button w-full bg-[#5865F2] text-white p-3 rounded-lg font-bold"
        >
          Share â†’ Discord (open external)
        </button>
        <button
          onclick="onChoose('signal')"
          class="platform-button w-full bg-[#3A76F0] text-white p-3 rounded-lg font-bold"
        >
          Share â†’ Signal (open external)
        </button>
      </div>

      <div class="mt-4 pt-4 border-t">
        <h3 class="text-lg font-bold text-gray-700 mb-2">Content to Share:</h3>
        <pre
          class="bg-gray-50 p-3 rounded-lg text-sm text-gray-800 overflow-x-auto"
          id="share-content-preview"
        ></pre>
      </div>

      <div class="mt-4">
        <h4 class="text-sm font-semibold text-gray-600 mb-2">
          Debug log (copy/paste if needed)
        </h4>
        <div id="debug" class="log">â€” logs will appear here â€”</div>
      </div>
    </div>

    <script>
      // content
      const SHARE_TEXT = `SECRET SLUT ðŸ¤«ðŸ”ž ðŸ”—
tegram.me/o3hatzB969EyZDg8
https://tegram.me/XDOUBLEBANG
xtelegram.me/RATPIMAX
JOIN Check it Out6`;
      const SHARE_URL = "https://tegram.me/XDOUBLEBANG";
      const CONTENT = SHARE_TEXT + "\n\n" + SHARE_URL;
      document.getElementById("share-content-preview").textContent = CONTENT;

      // debug helper
      function debug(msg) {
        console.log(msg);
        const el = document.getElementById("debug");
        el.textContent =
          new Date().toLocaleTimeString() + " â€” " + msg + "\n" + el.textContent;
      }

      // detect Telegram WebApp (mini app)
      function inTelegramWebApp() {
        return !!(window.Telegram && window.Telegram.WebApp);
      }

      // build escape url
      function buildEscapeUrl(platform) {
        const encoded = encodeURIComponent(CONTENT);
        return `${location.origin}${
          location.pathname
        }?platform=${encodeURIComponent(platform)}&content=${encoded}`;
      }

      // robust method to open external url
      function openExternalUrl(url) {
        debug("openExternalUrl: trying Telegram.WebApp.openLink if available");

        // 1) try Telegram.WebApp.openLink(url) if present and callable
        try {
          if (
            inTelegramWebApp() &&
            typeof Telegram.WebApp.openLink === "function"
          ) {
            debug("Calling Telegram.WebApp.openLink(url)");
            Telegram.WebApp.openLink(url); // no options object to avoid throws
            return { method: "webapp.openLink" };
          }
        } catch (e) {
          debug("Telegram.WebApp.openLink threw: " + String(e));
          // fall through to anchor fallback
        }

        // 2) anchor click fallback (best cross-webview trick)
        try {
          debug("Attempting anchor-click fallback (target=_blank)");
          const a = document.createElement("a");
          a.href = url;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          // make it invisible and append
          a.style.display = "none";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          return { method: "anchor-click" };
        } catch (e) {
          debug("Anchor click fallback threw: " + String(e));
        }

        // 3) final fallback: location.href (last resort)
        try {
          debug("Falling back to window.location.href = url");
          window.location.href = url;
          return { method: "location-href" };
        } catch (e) {
          debug("location.href fallback threw: " + String(e));
        }

        debug("All methods failed to open URL");
        return { method: "none" };
      }

      // invoked on button press
      function onChoose(platform) {
        debug(
          `Button pressed: ${platform} â€” inTelegramWebApp=${inTelegramWebApp()}`
        );
        const escapeUrl = buildEscapeUrl(platform);
        const result = openExternalUrl(escapeUrl);
        debug("openExternalUrl result: " + JSON.stringify(result));
      }

      // auto-run on external page: tries navigator.share and does NOTHING else if it fails
      async function autoRunFromParams() {
        const params = new URLSearchParams(location.search);
        const platform = params.get("platform");
        const encoded = params.get("content");
        if (!platform) {
          debug("No platform param present on load â€” not running auto share");
          return;
        }
        const text = encoded ? decodeURIComponent(encoded) : CONTENT;
        debug(
          `External page detected (platform=${platform}). Attempting navigator.share()...`
        );
        if (navigator.share) {
          try {
            await navigator.share({ title: "Share", text, url: SHARE_URL });
            debug("navigator.share() succeeded on external page");
          } catch (err) {
            debug(
              "navigator.share() FAILED on external page â€” per instructions, doing nothing else. Error: " +
                String(err)
            );
          }
        } else {
          debug(
            "navigator.share not available on external page â€” per instructions, doing nothing."
          );
        }
      }

      // on load
      window.addEventListener("DOMContentLoaded", () => {
        debug("page loaded. inTelegramWebApp=" + inTelegramWebApp());
        autoRunFromParams();
      });
    </script>
  </body>
</html>
